apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "web3-gateway.fullname" . }}-config
  labels:
    {{- include "web3-gateway.labels" . | nindent 4 }}
data:
  application.yaml: |
    server:
      port: {{ .Values.service.port }}
    gateway:
      blockchainNetworks:
{{- range .Values.config.blockchainNetworks }}
        - {{ . | quote }}
{{- end }}
      rateLimitPerSecond: {{ .Values.config.rateLimitPerSecond }}
      circuitBreaker:
        failureThreshold: {{ .Values.config.circuitBreaker.failureThreshold }}
        recoverySeconds: {{ .Values.config.circuitBreaker.recoverySeconds }}
      observability:
        requestLogSampling: {{ .Values.config.observability.requestLogSampling }}
        metrics:
          enabled: {{ .Values.config.observability.metrics.enabled }}
          path: {{ .Values.config.observability.metrics.path | quote }}
          port: {{ .Values.config.observability.metrics.port }}
      upstreams:
{{- range $name, $upstream := .Values.config.upstreams }}
        {{ $name }}:
          host: {{ $upstream.host | quote }}
          port: {{ $upstream.port }}
{{- end }}
      audit:
        enabled: {{ .Values.config.audit.enabled }}
        topic: {{ .Values.config.audit.topic | quote }}
        sink: {{ .Values.config.audit.sink | quote }}
      bankIntegrations:
        apis:
{{- range $name, $api := .Values.config.bankIntegrations.apis }}
          {{ $name }}:
            baseUrl: {{ $api.baseUrl | quote }}
            authProfile: {{ $api.authProfile | quote }}
            timeoutSeconds: {{ $api.timeoutSeconds }}
            description: {{ $api.description | quote }}
{{- end }}
        streams:
{{- range $name, $stream := .Values.config.bankIntegrations.streams }}
          {{ $name }}:
            topic: {{ $stream.topic | quote }}
            consumerGroup: {{ $stream.consumerGroup | quote }}
            broker: {{ $stream.broker | quote }}
            format: {{ $stream.format | quote }}
            notes: {{ $stream.notes | quote }}
{{- end }}
